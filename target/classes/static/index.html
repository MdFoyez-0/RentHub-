<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .property-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(219, 19, 19, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .filter-section {
            transition: all 0.3s ease;
        }
        
        .heart-icon {
            transition: all 0.2s ease;
        }
        
        .heart-icon:hover {
            transform: scale(1.1);
        }
        
        .heart-icon.active {
            color: #ef4444;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-indigo-600 rounded-lg"></div>
                    <span class="text-xl font-bold text-gray-800">RentHub</span>
                </div>
                
                <!-- Search Bar -->
                <div class="hidden md:flex flex-1 max-w-2xl mx-8">
                    <div class="relative w-full">
                        <input type="text" placeholder="Search for properties, locations..." 
                               class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="flex items-center space-x-6">
                    <a href="#" class="text-gray-600 hover:text-indigo-600 font-medium">Rent</a>
                    <a href="#" class="text-gray-600 hover:text-indigo-600 font-medium">Buy</a>
                    <a href="#" class="text-gray-600 hover:text-indigo-600 font-medium">Sell</a>
                    <a href="#" class="text-gray-600 hover:text-indigo-600 font-medium">Favorites</a>
                   <button id="authButton" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors">
    Sign In
</button>
                </nav>
            </div>
            
            <!-- Mobile Search -->
            <div class="mt-4 md:hidden">
                <div class="relative">
                    <input type="text" placeholder="Search for properties, locations..." 
                           class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Hero Section -->
        <section class="mb-12">
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-8 text-white">
                <div class="max-w-xl">
                    <h1 class="text-4xl font-bold mb-4">Find Your Perfect Rental Home</h1>
                    <p class="text-lg mb-6">Discover thousands of apartments, houses, and condos for rent in your area.</p>
                    <button class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                        Explore Properties
                    </button>
                </div>
            </div>
        </section>

        <!-- Filters -->
        <section class="mb-8">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex flex-wrap gap-4">
                    <!-- Location Filter -->
<select id="locationFilter" class="w-full pl-3 pr-10 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent appearance-none">
    <option>Any Location</option>
    <option>Uttara</option>
    <option>Bashundhara</option>
    <option>Banasree</option>
</select>

<!-- Price Range -->
<select id="priceFilter" class="w-full pl-3 pr-10 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent appearance-none">
    <option>Any Price</option>
    <option>Under 10,000 TK</option>
    <option>10,000 TK - 12,500 TK</option>
    <option>12,500 TK - 14,000 TK</option>
    <option>Over 14,000 TK</option>
</select>

<!-- Bedrooms -->
<select id="bedroomFilter" class="w-full pl-3 pr-10 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent appearance-none">
    <option>Any</option>
    <option>Studio</option>
    <option>1 Bed</option>
    <option>2 Beds</option>
    <option>3+ Beds</option>
</select>
                            <i class="fas fa-chevron-down absolute right-3 top-3 text-gray-400 pointer-events-none"></i>
                        </div>
                    </div>
                    
                    <!-- More Filters Button -->
                    <div class="flex items-end">
                        <button class="text-indigo-600 font-medium flex items-center">
                            <i class="fas fa-sliders-h mr-2"></i>
                            More Filters
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Property Listings -->
        <section>
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Available Properties</h2>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-600">Sort by:</span>
                    <select class="border border-gray-300 rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option>Newest</option>
                        <option>Price: Low to High</option>
                        <option>Price: High to Low</option>
                        <option>Most Popular</option>
                    </select>
                </div>
            </div>
           
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="propertiesContainer">
    <!-- Properties will load here dynamically from Spring Boot -->
</div>

<!-- Load More Button -->
<div class="flex justify-center mt-8">
    <button class="bg-white border border-gray-300 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-50 transition-colors">
        Load More Properties
    </button>
</div>
</section>
</main>

<!-- Footer -->
<footer class="bg-gray-800 text-white mt-12">
    <div class="container mx-auto px-4 py-12">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
            <!-- Company Info -->
            <div>
                <div class="flex items-center space-x-2 mb-4">
                    <div class="w-8 h-8 bg-indigo-500 rounded-lg"></div>
                    <span class="text-xl font-bold">RentHub</span>
                </div>
                <p class="text-gray-400 mb-4">
                    Find your perfect rental home with RentHub. Thousands of properties available across the country.
                </p>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
            </div>
            
            <!-- Quick Links -->
            <div>
                <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                <ul class="space-y-2">
                    <li><a href="#" class="text-gray-400 hover:text-white">Browse Properties</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">List Your Property</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">Rental Guides</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">Neighborhoods</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">Agent Finder</a></li>
                </ul>
            </div>
            
            <!-- Support -->
            <div>
                <h3 class="text-lg font-semibold mb-4">Support</h3>
                <ul class="space-y-2">
                    <li><a href="#" class="text-gray-400 hover:text-white">Help Center</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">Contact Us</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">FAQs</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-white">Terms of Service</a></li>
                </ul>
            </div>
            
            <!-- Newsletter -->
            <div>
                <h3 class="text-lg font-semibold mb-4">Stay Updated</h3>
                <p class="text-gray-400 mb-4">Subscribe to our newsletter for the latest listings and updates.</p>
                <div class="flex">
                    <input type="email" placeholder="Your email" class="px-4 py-2 rounded-l-lg w-full text-gray-800 focus:outline-none">
                    <button class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-r-lg font-medium">
                        Subscribe
                    </button>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        console.log("üîç Script loading...");

        // ============ AUTHENTICATION HANDLERS ============

        // Check login status and update Sign In button
        function updateAuthButton() {
            console.log("üîÑ updateAuthButton() called - FORCING SIGN IN");

            const authButton = document.getElementById('authButton');
            console.log("Auth button found:", authButton);

            if (!authButton) {
                console.error("‚ùå authButton element not found!");
                return;
            }

            // ALWAYS show "Sign In" button (for testing)
            console.log("üë§ Showing Sign In button (forced)");
            authButton.innerHTML = 'Sign In';
            authButton.onclick = function() {
                console.log("Sign In button clicked, redirecting to Login.html");
                window.location.href = 'Login.html';
            };

            console.log("‚úÖ Auth button updated successfully - FORCED SIGN IN");
        }

        // ============ PROPERTY MANAGEMENT ============

        // Property loading from Spring Boot
        async function loadProperties() {
            try {
                console.log("üì° Loading properties from Spring Boot...");

                // First, check if we have properties
                const countResponse = await fetch('http://localhost:8080/api/properties/count');
                const countText = await countResponse.text();

                console.log("Property count:", countText);

                // If no properties, add sample data
                if (countText.includes("0")) {
                    console.log("üîÑ Adding sample data...");
                    await fetch('http://localhost:8080/api/properties/sample', {
                        method: 'POST'
                    });
                }

                // Load available properties from backend
                const response = await fetch('http://localhost:8080/api/properties/available');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const properties = await response.json();
                console.log(`‚úÖ Loaded ${properties.length} properties from backend`);

                // Display properties
                displayProperties(properties);

            } catch (error) {
                console.error('‚ùå Error loading from backend:', error);
                displayFallbackProperties();
            }
        }

        function displayProperties(properties) {
            // ‚úÖ Use ID selector
            const container = document.getElementById('propertiesContainer');

            if (!container) {
                console.error('‚ùå Properties container not found!');
                return;
            }

            container.innerHTML = '';

            if (properties.length === 0) {
                container.innerHTML = `
                    <div class="col-span-3 text-center py-12">
                        <i class="fas fa-home text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-medium text-gray-700">No properties available</h3>
                        <p class="text-gray-500 mt-2">Check back later for new listings</p>
                        <button onclick="loadProperties()" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                            Refresh
                        </button>
                    </div>
                `;
                return;
            }

            properties.forEach(property => {
                const price = property.price ? property.price.toLocaleString('en-BD') : 'N/A';
                const imageUrl = property.imageUrl || 'https://images.unsplash.com/photo-1568605114967-8130f3a36994';
                const location = property.location || 'Location not specified';
                const bedrooms = property.bedrooms || 0;
                const bathrooms = property.bathrooms || 0;
                const area = property.area ? Math.round(property.area) : 0;
                const propertyType = property.propertyType || 'For Rent';

                const card = document.createElement('div');
                card.className = 'property-card bg-white rounded-xl shadow-sm overflow-hidden';
                card.innerHTML = `
                    <div class="relative">
                        <img src="${imageUrl}"
                             alt="${property.title}"
                             class="w-full h-48 object-cover">
                        <div class="absolute top-3 right-3 bg-white rounded-full p-2 shadow-md heart-icon">
                            <i class="far fa-heart text-gray-400"></i>
                        </div>
                        <div class="absolute top-3 left-3 bg-indigo-600 text-white text-sm font-medium px-2 py-1 rounded">
                            ${propertyType}
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-lg font-semibold text-gray-800">${property.title}</h3>
                            <span class="text-lg font-bold text-indigo-600">${price} TK/mo</span>
                        </div>
                        <p class="text-gray-600 mb-3 flex items-center">
                            <i class="fas fa-map-marker-alt text-gray-400 mr-2"></i>
                            ${location}
                        </p>
                        <div class="flex justify-between text-sm text-gray-500 border-t border-gray-100 pt-3">
                            <span class="flex items-center">
                                <i class="fas fa-bed text-gray-400 mr-1"></i>
                                ${bedrooms} ${bedrooms === 1 ? 'Bed' : 'Beds'}
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-bath text-gray-400 mr-1"></i>
                                ${bathrooms} ${bathrooms === 1 ? 'Bath' : 'Baths'}
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-vector-square text-gray-400 mr-1"></i>
                                ${area} sqft
                            </span>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });

            // Re-attach heart icon click events
            attachHeartClickEvents();
        }

        // Fallback properties if backend fails
        function displayFallbackProperties() {
            const fallbackProperties = [
                {
                    title: "Modern Apartment",
                    price: 10000,
                    location: "Uttara, Dhaka",
                    bedrooms: 2,
                    bathrooms: 2,
                    area: 950,
                    propertyType: "apartment",
                    imageUrl: "https://images.unsplash.com/photo-1568605114967-8130f3a36994"
                },
                {
                    title: "Cozy House",
                    price: 12500,
                    location: "Bashundhara, Dhaka",
                    bedrooms: 3,
                    bathrooms: 2,
                    area: 1250,
                    propertyType: "house",
                    imageUrl: "https://images.unsplash.com/photo-1518780664697-55e3ad937233"
                },
                {
                    title: "Luxury Condo",
                    price: 14000,
                    location: "Banasree, Dhaka",
                    bedrooms: 2,
                    bathrooms: 2,
                    area: 1100,
                    propertyType: "condo",
                    imageUrl: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00"
                }
            ];

            displayProperties(fallbackProperties);
        }

        // Heart icon click handler
        function attachHeartClickEvents() {
            document.querySelectorAll('.heart-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const heart = this.querySelector('i');
                    heart.classList.toggle('far');
                    heart.classList.toggle('fas');
                    heart.classList.toggle('text-red-500');
                });
            });
        }

        // Filter properties with backend
        async function filterProperties() {
            const location = document.getElementById('locationFilter').value;
            const price = document.getElementById('priceFilter').value;
            const bedrooms = document.getElementById('bedroomFilter').value;

            let url = 'http://localhost:8080/api/properties/search?';
            const params = [];

            if (location && location !== 'Any Location') {
                params.push(`location=${encodeURIComponent(location)}`);
            }

            if (bedrooms && bedrooms !== 'Any') {
                let bedValue;
                switch(bedrooms) {
                    case 'Studio': bedValue = 0; break;
                    case '1 Bed': bedValue = 1; break;
                    case '2 Beds': bedValue = 2; break;
                    case '3+ Beds': bedValue = 3; break;
                    default: bedValue = null;
                }
                if (bedValue !== null) params.push(`bedrooms=${bedValue}`);
            }

            if (price && price !== 'Any Price') {
                if (price === 'Under 10,000 TK') {
                    params.push('maxPrice=10000');
                } else if (price === 'Over 14,000 TK') {
                    params.push('minPrice=14000');
                } else if (price.includes('-')) {
                    const [min, max] = price.split('-').map(s =>
                        parseInt(s.replace(/[^0-9]/g, ''))
                    );
                    if (min) params.push(`minPrice=${min}`);
                    if (max) params.push(`maxPrice=${max}`);
                }
            }

            if (params.length > 0) {
                url += params.join('&');
                try {
                    const response = await fetch(url);
                    const properties = await response.json();
                    displayProperties(properties);
                } catch (error) {
                    console.error('Filter error:', error);
                    loadProperties(); // Fallback to all
                }
            } else {
                loadProperties(); // Load all if no filters
            }
        }

        // ============ INITIALIZATION ============

        // Initialize everything on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM fully loaded, initializing RentHub system...');

            // Test: Can we access the button?
            const testButton = document.getElementById('authButton');
            console.log("Test - Button element found:", testButton);
            console.log("Test - Button HTML:", testButton?.outerHTML);

            // 1. Update authentication button
            updateAuthButton();

            // 2. Load properties
            loadProperties();

            // 3. Setup filter listeners
            document.getElementById('locationFilter').addEventListener('change', filterProperties);
            document.getElementById('priceFilter').addEventListener('change', filterProperties);
            document.getElementById('bedroomFilter').addEventListener('change', filterProperties);

            console.log("‚úÖ Initialization complete");
        });

        // Also try calling updateAuthButton after a short delay as backup
        setTimeout(function() {
            console.log("‚è∞ Backup timeout check...");
            updateAuthButton();
        }, 1000);
    </script>
</body>
</html>